import jwt from 'jsonwebtoken'

export const secret = process.env.JWT_SECRET || `i456asfdADFafadil_w`

// A GraphQL schema, using SDL (schema definition language)
export const typeDefs = `#gql
  type User {
    email: String
    token: String
    error: JSON
  }
  type Mutation {
    login( email: String password: String ): User
    logout: User
  }
`

//  Resolver definition for each API endpoint â€” js object
export const resolvers = {
  Mutation: {
    login: (_1,{email,password}) => login(email,password),
    logout: (_1,_2,ctx) => logout(ctx),
  }
}

// Resolvers
function login(email,password) {
  if (!email || email.length === 0) return {error:{message:'Email required!'}}
  if (!password || password.length === 0) return {error:{message:'Password required!'}}
  const token = jwt.sign({ email }, secret,{ expiresIn: '1d' });
  return {email,token}
}

function logout(ctx) {
  console.log({user:ctx.req.user});
  return {}
}
export default {typeDefs,resolvers,secret}
